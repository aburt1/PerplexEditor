<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perplexity API Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-right: 10px;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        .result {
            margin-top: 20px;
            padding: 16px;
            border-radius: 8px;
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            white-space: pre-wrap;
            font-family: monospace;
        }
        
        .error {
            background: #fee2e2;
            border-color: #fecaca;
            color: #991b1b;
        }
        
        .success {
            background: #d1fae5;
            border-color: #a7f3d0;
            color: #065f46;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Perplexity API Test</h1>
        <p>Use this page to test the Perplexity API independently of the extension.</p>
        
        <div class="form-group">
            <label for="apiKey">API Key:</label>
            <input type="text" id="apiKey" placeholder="Enter your Perplexity API key">
        </div>
        
        <div class="form-group">
            <label for="testText">Text to Process:</label>
            <textarea id="testText" placeholder="Enter some text to test...">This is a sample text that needs to be rewritten to make it clearer and more engaging.</textarea>
        </div>
        
        <div class="form-group">
            <label for="prompt">Custom Prompt:</label>
            <textarea id="prompt" placeholder="Enter your custom prompt...">Rewrite the following text to make it clearer and more engaging. IMPORTANT: Return ONLY the rewritten text. Preserve any existing dashes, hyphens, or symbols that are part of the original text, but do not add new quotes, dashes, explanations, or any other text. Just return the rewritten text:</textarea>
        </div>
        
        <button onclick="testAPI()">Test API Call</button>
        <button onclick="clearResult()">Clear Result</button>
        
        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        async function testAPI() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const text = document.getElementById('testText').value.trim();
            const prompt = document.getElementById('prompt').value.trim();
            
            if (!apiKey) {
                showResult('Please enter your API key', 'error');
                return;
            }
            
            if (!text) {
                showResult('Please enter some text to process', 'error');
                return;
            }
            
            if (!prompt) {
                showResult('Please enter a prompt', 'error');
                return;
            }
            
            try {
                showResult('Testing API call...', 'info');
                
                const fullPrompt = `${prompt}\n\nText: "${text}"`;
                
                const requestBody = {
                    model: 'sonar',
                    messages: [
                        {
                            role: 'user',
                            content: fullPrompt
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.7
                };
                
                console.log('Request body:', requestBody);
                
                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                console.log('Response status:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    showResult(`API Error: ${response.status} ${response.statusText}\n\nResponse: ${errorText}`, 'error');
                    return;
                }
                
                const data = await response.json();
                console.log('API Response data:', data);
                
                if (data.choices && data.choices[0] && data.choices[0].message) {
                    const result = data.choices[0].message.content.trim();
                    showResult(`✅ Success!\n\nOriginal Text:\n${text}\n\nAI Response:\n${result}\n\nFull API Response:\n${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult(`❌ Unexpected API response format:\n${JSON.stringify(data, null, 2)}`, 'error');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showResult(`❌ Error: ${error.message}`, 'error');
            }
        }
        
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
        }
        
        function clearResult() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'none';
        }
    </script>
</body>
</html>
